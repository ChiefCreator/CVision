generator client {
  provider = "prisma-client-js"
  output   = "generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  email              String     @unique
  password           String
  name               String
  picture            String?
  role               UserRole   @default(regular)
  isVerified         Boolean    @default(false) @map("is_verified")
  isTwoFactorEnabled Boolean    @default(false) @map("is_two_factor_enabled")
  authMethod         AuthMethod @default(credentials) @map("auth_method")

  accounts Account[]
  resumes  Resume[]
}

model Account {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  type     String
  provider String

  refreshToken String? @map("refresh_token")
  accessToken  String  @map("access_token")

  userId String @map("user_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Token {
  id String @id @default(uuid())

  email     String
  token     String    @unique
  type      TokenType
  expiresIn DateTime  @map("expires_in")
}

enum TokenType {
  verification
  two_factor
  password_reset
}

enum UserRole {
  regular
  admin
}

enum AuthMethod {
  credentials
  google
  yandex
}

enum ResumeTemplate {
  classic
  modern
  creative
  professional
}

model Resume {
  id        String         @id @default(uuid())
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")
  template  ResumeTemplate @default(classic)

  title                     String?
  personalDetails           PersonalDetails?
  professionalSummary       ProfessionalSummary?
  employmentHistory         EmploymentHistory?
  education                 Education?
  links                     Links?
  skills                    Skills?
  languages                 Languages?
  courses                   Courses?
  internships               Internships?
  hobbies                   Hobbies?
  extraCurricularActivities ExtraCurricularActivities?
  references                References?
  customSections            CustomSections[]

  userId String @map("user_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum SectionTypes {
  personalDetails
  professionalSummary
  employmentHistory
  education
  links
  skills
  languages
  courses
  internships
  hobbies
  extraCurricularActivities
  references
  customSections
}

model GeneralSection {
  id   String       @id @default(uuid())
  type SectionTypes @unique

  defaultTitle String
  description  String?

  personalDetails           PersonalDetails[]
  professionalSummary       ProfessionalSummary[]
  employmentHistory         EmploymentHistory[]
  education                 Education[]
  links                     Links[]
  skills                    Skills[]
  languages                 Languages[]
  courses                   Courses[]
  internships               Internships[]
  hobbies                   Hobbies[]
  extraCurricularActivities ExtraCurricularActivities[]
  references                References[]
  customSections            CustomSections[]
}

model PersonalDetails {
  id    String  @id @default(uuid())
  title String?

  avatarUrl      String? @map("avatar_url")
  jobTitle       String? @map("job_title")
  fullName       String? @map("full_name")
  email          String?
  phone          String?
  address        String?
  city           String?
  country        String?
  postalCode     String? @map("postal_code")
  drivingLicense String? @map("driving_license")
  birthPlace     String? @map("birth_place")
  birthDate      String? @map("birth_date")
  nationality    String?

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model ProfessionalSummary {
  id    String  @id @default(uuid())
  title String?

  summary String?

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model EmploymentHistory {
  id    String                        @id @default(uuid())
  title String?
  order Int
  data  EmploymentHistorySubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model EmploymentHistorySubsection {
  id    String @id @default(uuid())
  order Int

  jobTitle    String? @map("job_title")
  employer    String?
  startDate   String? @map("start_date")
  endDate     String? @map("end_date")
  city        String?
  description String?

  sectionId String @map("section_id")

  section EmploymentHistory @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Education {
  id    String                @id @default(uuid())
  title String?
  order Int
  data  EducationSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model EducationSubsection {
  id    String @id @default(uuid())
  order Int

  school      String?
  degree      String?
  startDate   String? @map("start_date")
  endDate     String? @map("end_date")
  city        String?
  description String?

  sectionId String @map("section_id")

  section Education @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Links {
  id    String           @id @default(uuid())
  title String?
  order Int
  data  LinkSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model LinkSubsection {
  id    String @id @default(uuid())
  order Int

  label String?
  url   String?

  sectionId String @map("section_id")

  section Links @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Skills {
  id          String            @id @default(uuid())
  title       String?
  order       Int
  isShowLevel Boolean           @default(true)
  data        SkillSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model SkillSubsection {
  id    String @id @default(uuid())
  order Int

  title String?
  level SkillLevel? @default(expert)

  sectionId String @map("section_id")

  section Skills @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Languages {
  id    String               @id @default(uuid())
  title String?
  order Int
  data  LanguageSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model LanguageSubsection {
  id    String @id @default(uuid())
  order Int

  title String?
  level LanguageLevel?

  sectionId String @map("section_id")

  section Languages @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Courses {
  id    String             @id @default(uuid())
  title String?
  order Int
  data  CourseSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model CourseSubsection {
  id    String @id @default(uuid())
  order Int

  title       String?
  institution String?
  startDate   String? @map("start_date")
  endDate     String? @map("end_date")

  sectionId String @map("section_id")

  section Courses @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Internships {
  id    String                 @id @default(uuid())
  title String?
  order Int
  data  InternshipSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model InternshipSubsection {
  id    String @id @default(uuid())
  order Int

  jobTitle    String? @map("job_title")
  employer    String?
  startDate   String? @map("start_date")
  endDate     String? @map("end_date")
  city        String?
  description String?

  sectionId String @map("section_id")

  section Internships @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Hobbies {
  id               String  @id @default(uuid())
  title            String?
  order            Int
  hobbyDescription String?

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model ExtraCurricularActivities {
  id    String                              @id @default(uuid())
  title String?
  order Int
  data  ExtraCurricularActivitySubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model ExtraCurricularActivitySubsection {
  id    String @id @default(uuid())
  order Int

  functionTitle String? @map("function_title")
  employer      String?
  startDate     String? @map("start_date")
  endDate       String? @map("end_date")
  city          String?
  description   String?

  sectionId String @map("section_id")

  section ExtraCurricularActivities @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model References {
  id    String                @id @default(uuid())
  title String?
  order Int
  data  ReferenceSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @unique @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model ReferenceSubsection {
  id    String @id @default(uuid())
  order Int

  referentFullName String? @map("referent_full_name")
  company          String?
  phone            String?
  email            String?

  sectionId String @map("section_id")

  section References @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model CustomSections {
  id    String             @id @default(uuid())
  title String?
  order Int
  data  CustomSubsection[]

  generalSectionId String @map("general_section_id")
  resumeId         String @map("resume_id")

  generalSection GeneralSection @relation(fields: [generalSectionId], references: [id], onDelete: Cascade)
  resume         Resume         @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model CustomSubsection {
  id    String @id @default(uuid())
  order Int

  title       String?
  city        String?
  startDate   String? @map("start_date")
  endDate     String? @map("end_date")
  description String?

  sectionId String @map("section_id")

  section CustomSections @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

enum SkillLevel {
  novice
  beginner
  skillful
  experienced
  expert
}

enum LanguageLevel {
  nativeSpeaker
  highlyProficient
  goodWorkingKnowledge
  workingKnowledge
  A1
  A2
  B1
  B2
  C1
  C2
}
